<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ShopHub - Premium Online Store</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    /* üé® Premium Color Palette */
    :root {
      --default-primary: #001f3f;
      --default-secondary: #004d40;
      --color-primary: var(--default-primary);
      --color-secondary: var(--default-secondary);
      --color-accent: #ffd700;
    }

    body, button, header, footer, div, input, select, textarea {
      transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
    }

    /* Tailwind Overrides */
    .bg-indigo-600 { background-color: var(--color-primary); }
    .text-indigo-600 { color: var(--color-primary); }
    
    /* ‚öôÔ∏è Sidebar Transitions */
    .sidebar-wrapper {
      position: fixed; left: 0; top: 0; height: 100%; width: 20rem; 
      background-color: white; box-shadow: 0 0 40px rgba(0,0,0,0.3); z-index: 50;
      transform: translateX(-100%); transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      display: flex; flex-direction: column;
    }
    .sidebar-open .sidebar-wrapper { transform: translateX(0); }
    .backdrop {
      position: fixed; inset: 0; background-color: rgba(0,0,0,0.6); z-index: 40;
      opacity: 0; transition: opacity 0.3s ease-in-out; pointer-events: none;
    }
    .sidebar-open .backdrop { opacity: 1; pointer-events: auto; }

    /* üåü Dropdown Logic */
    .group:hover .dropdown-menu { visibility: visible; opacity: 1; transform: translateY(0); }
    .dropdown-menu {
      visibility: hidden; opacity: 0; transform: translateY(10px);
      transition: all 0.2s cubic-bezier(0.16, 1, 0.3, 1); z-index: 100;
    }

    /* üåü SILKIER & SLOWER Animation (0.8s) */
    .overlay-enter { animation: overlayIn 0.8s cubic-bezier(0.65, 0, 0.35, 1) forwards; }
    .overlay-exit { animation: overlayOut 0.8s cubic-bezier(0.65, 0, 0.35, 1) forwards; }

    @keyframes overlayIn {
      from { clip-path: circle(0% at 50% 50%); }
      to { clip-path: circle(150% at 50% 50%); }
    }
    @keyframes overlayOut {
      from { opacity: 1; }
      to { opacity: 0; visibility: hidden; }
    }
    
    .bounce-icon { animation: bounce 2s infinite; }
    @keyframes bounce { 0%, 100% { transform: translateY(-15%); } 50% { transform: translateY(0); } }

    /* Utilities */
    .cart-pulse { animation: pulse-cart 0.3s ease-in-out; }
    @keyframes pulse-cart { 50% { transform: scale(1.15) rotate(5deg); } }
    .page-enter { animation: slideInFromTop 0.5s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }
    @keyframes slideInFromTop { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
    .loader {
      border: 3px solid #f3f3f3; border-radius: 50%; border-top: 3px solid var(--color-primary);
      width: 20px; height: 20px; animation: spin 1s linear infinite;
    }
    @keyframes spin { 100% { transform: rotate(360deg); } }
  </style>
</head>
<body class="bg-gray-50 text-gray-800">
  
  <div id="category-loader" class="fixed inset-0 z-[100] hidden flex-col items-center justify-center text-white" style="background-color: var(--color-primary);">
     <div class="text-8xl mb-6 bounce-icon" id="loader-icon">‚ú®</div>
     <h2 class="text-4xl font-extrabold tracking-widest uppercase drop-shadow-lg" id="loader-text">Loading...</h2>
  </div>

  <div id="app" class="min-h-screen flex flex-col font-sans"></div>

  <script type="module">
    // --- Config ---
    const SUPABASE_URL = 'https://thzmryhnyzhfewsyamjh.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRoem1yeWhueXpoZmV3c3lhbWpoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ3NTgwMTAsImV4cCI6MjA4MDMzNDAxMH0.qvCid4pmsdcRogce4RZH5adl90Eq5d3ibwVoJI5qr-I';
    const ADMIN_EMAIL = 'utkwholesale.sup@gmail.com';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // --- Themes ---
    const CATEGORY_THEMES = {
      'candies-chocolates': { primary: '#ec4899', secondary: '#be185d', icon: 'üç¨' },
      'tobacco-products':   { primary: '#78350f', secondary: '#451a03', icon: 'üö¨' },
      'automotive':         { primary: '#dc2626', secondary: '#991b1b', icon: 'üöó' },
      'medicines':          { primary: '#059669', secondary: '#065f46', icon: 'üíä' },
      'toys':               { primary: '#f59e0b', secondary: '#b45309', icon: 'üß∏' },
      'household':          { primary: '#4f46e5', secondary: '#312e81', icon: 'üè†' },
      'general-grocery':    { primary: '#0891b2', secondary: '#164e63', icon: 'ü•¶' },
      'snacks':             { primary: '#d97706', secondary: '#92400e', icon: 'üçø' },
      'default':            { primary: '#001f3f', secondary: '#004d40', icon: '‚ú®' }
    };

    // --- State ---
    let state = {
      user: null,
      isAdmin: false,
      currentPage: 'home',
      currentSlug: null,
      categories: [],
      products: [],
      cart: [],
      menuOpen: false,
      authMode: 'signin',
      loading: false,
      // Admin State
      adminTab: 'add', // 'add' or 'edit'
      adminSelectedCategory: '',
      adminSelectedProduct: null,
      adminForm: {}
    };

    // --- Router ---
    async function navigate(page, slug = null) {
      if (page === 'admin' && !state.isAdmin) {
        alert("Unauthorized access.");
        navigate('home');
        return;
      }

      if (page === 'category' && slug) {
        // Sexy Animation Logic
        const theme = CATEGORY_THEMES[slug] || CATEGORY_THEMES['default'];
        const loader = document.getElementById('category-loader');
        
        // Setup Overlay
        loader.style.backgroundColor = theme.primary;
        document.getElementById('loader-icon').textContent = theme.icon || '‚ú®';
        document.getElementById('loader-text').textContent = state.categories.find(c => c.slug === slug)?.name || 'Loading...';
        
        loader.classList.remove('hidden', 'overlay-exit');
        loader.classList.add('flex', 'overlay-enter');
        
        // Wait for the slow smooth animation
        await new Promise(r => setTimeout(r, 1000));

        updateTheme(slug);
        state.currentPage = page;
        state.currentSlug = slug;
        state.menuOpen = false;
        window.scrollTo(0, 0);
        render();

        // Exit Animation
        setTimeout(() => {
          loader.classList.remove('overlay-enter');
          loader.classList.add('overlay-exit');
          setTimeout(() => {
             loader.classList.add('hidden');
             loader.classList.remove('flex');
          }, 800);
        }, 200);

      } else {
        if (page !== 'admin') resetTheme();
        state.currentPage = page;
        state.currentSlug = slug;
        state.menuOpen = false;
        window.scrollTo(0, 0);
        render();
      }
    }

    function updateTheme(slug) {
      const theme = CATEGORY_THEMES[slug] || CATEGORY_THEMES['default'];
      document.documentElement.style.setProperty('--color-primary', theme.primary);
      document.documentElement.style.setProperty('--color-secondary', theme.secondary);
    }
    function resetTheme() {
      const theme = CATEGORY_THEMES['default'];
      document.documentElement.style.setProperty('--color-primary', theme.primary);
      document.documentElement.style.setProperty('--color-secondary', theme.secondary);
    }

    // --- Admin Functions ---
    async function handleAddProduct(e) {
      e.preventDefault();
      const form = e.target;
      const productData = {
        name: form.name.value,
        price: parseFloat(form.price.value),
        description: form.description.value,
        category_id: form.category_id.value,
        image_url: form.image_url.value,
        slug: form.name.value.toLowerCase().replace(/ /g, '-') + '-' + Math.floor(Math.random() * 1000),
        is_active: true,
        stock_status: 'in_stock'
      };

      const { error } = await supabase.from('products').insert([productData]);
      if (error) alert('Error adding product: ' + error.message);
      else {
        alert('Product added successfully!');
        form.reset();
        await init(); // Refresh data
      }
    }

    async function handleUpdateProduct(e) {
      e.preventDefault();
      const form = e.target;
      const updates = {
        name: form.name.value,
        price: parseFloat(form.price.value),
        description: form.description.value,
        image_url: form.image_url.value,
        stock_status: form.stock_status.value
      };

      const { error } = await supabase.from('products').update(updates).eq('id', state.adminSelectedProduct.id);
      if (error) alert('Error updating: ' + error.message);
      else {
        alert('Product updated!');
        state.adminSelectedProduct = null;
        await init();
      }
    }

    async function handleDeleteProduct() {
      if(!confirm("Are you sure you want to delete this product?")) return;
      const { error } = await supabase.from('products').delete().eq('id', state.adminSelectedProduct.id);
      if (error) alert('Error deleting: ' + error.message);
      else {
        alert('Product deleted.');
        state.adminSelectedProduct = null;
        await init();
      }
    }

    // --- Auth & Data ---
    async function handleAuth(e) {
      e.preventDefault();
      const email = e.target.email.value;
      const password = e.target.password.value;
      state.loading = true; render();
      
      let error = null;
      if (state.authMode === 'signup') {
        const { error: suError } = await supabase.auth.signUp({ email, password });
        if (!suError) alert('Registration successful! Please sign in.');
        error = suError;
      } else {
        const { error: siError } = await supabase.auth.signInWithPassword({ email, password });
        error = siError;
      }
      
      state.loading = false;
      if (error) { alert(error.message); render(); } 
      else if (state.authMode === 'signin') navigate('home');
    }

    async function handleLogout() {
      await supabase.auth.signOut();
      state.isAdmin = false;
      navigate('home');
    }

    // --- Components ---

    function Header() {
      // üåü FIX: Removed max-w-7xl, used w-full px-6 to push icons to the edges
      return `
        <header class="bg-white shadow-md sticky top-0 z-40 border-b border-gray-100">
          <div class="w-full px-6 py-3 flex items-center justify-between">
            <div class="flex items-center gap-4">
              <button onclick="toggleMenu()" class="p-2 -ml-2 hover:bg-gray-100 rounded-lg transition-colors text-gray-700">
                <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
              </button>
              
              <a href="#" onclick="navigate('home'); return false;" class="text-2xl font-extrabold flex items-center gap-1" style="color: var(--color-primary);">
                Shop<span style="color: var(--color-accent);">Hub</span>
              </a>

              <div class="relative group ml-4 hidden md:block z-50">
                <button class="flex items-center gap-1 font-semibold text-gray-600 group-hover:text-indigo-600 transition-colors py-2">
                   Shop by Category <svg class="w-4 h-4 ml-1 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
                <div class="absolute top-full left-0 w-64 bg-white rounded-xl shadow-2xl border border-gray-100 overflow-hidden dropdown-menu pt-2">
                    <div class="py-2 max-h-[70vh] overflow-y-auto">
                        ${state.categories.map(cat => {
                            const theme = CATEGORY_THEMES[cat.slug] || CATEGORY_THEMES['default'];
                            return `<a href="#" onclick="navigate('category', '${cat.slug}'); return false;" class="flex items-center gap-3 px-4 py-3 hover:bg-gray-50 transition-colors border-b border-gray-50 last:border-0">
                                    <span class="text-xl w-6 text-center">${theme.icon || 'üì¶'}</span>
                                    <span class="font-bold text-sm text-gray-700">${cat.name}</span>
                                </a>`
                        }).join('')}
                    </div>
                </div>
              </div>
            </div>
            
            <div class="flex items-center gap-4">
              ${state.isAdmin ? `
                 <button onclick="navigate('admin')" class="bg-red-600 text-white px-3 py-1 rounded-md text-sm font-bold shadow hover:bg-red-700 transition">Admin Panel</button>
              ` : ''}

              ${state.user ? `
                <div class="hidden md:flex items-center gap-4">
                  <span class="text-sm font-medium text-gray-600">${state.user.email.split('@')[0]}</span>
                  <button onclick="handleLogout()" class="text-sm font-bold text-red-600 hover:text-red-800">Logout</button>
                </div>
              ` : `
                <button onclick="navigate('auth')" class="flex items-center gap-2 font-bold text-sm hover:text-indigo-600">Sign In</button>
              `}

              <button id="cart-icon-container" onclick="navigate('cart')" class="relative p-2 hover:bg-gray-100 rounded-lg">
                <svg class="w-7 h-7 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                ${state.cart.length > 0 ? `<span class="absolute -top-1 -right-1 bg-red-600 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center border-2 border-white">${state.cart.reduce((a,b)=>a+b.quantity,0)}</span>` : ''}
              </button>
            </div>
          </div>
        </header>
      `;
    }

    function AdminPage() {
      // Filter products based on selected category in the Edit tab
      const filteredProducts = state.adminSelectedCategory 
        ? state.products.filter(p => p.category_id === state.adminSelectedCategory)
        : [];

      return `
        <div class="flex-1 bg-gray-100 p-6 page-enter">
          <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-xl overflow-hidden">
            <div class="bg-gray-800 text-white p-6 flex justify-between items-center">
              <div>
                <h1 class="text-2xl font-bold">Admin Dashboard</h1>
                <p class="text-gray-400 text-sm">Logged in as ${state.user.email}</p>
              </div>
              <button onclick="navigate('home')" class="text-gray-300 hover:text-white underline">Back to Shop</button>
            </div>

            <div class="flex border-b">
              <button onclick="state.adminTab='add'; render()" class="flex-1 py-4 font-bold text-center ${state.adminTab === 'add' ? 'bg-indigo-50 text-indigo-700 border-b-2 border-indigo-700' : 'text-gray-500 hover:bg-gray-50'}">
                Add New Product
              </button>
              <button onclick="state.adminTab='edit'; render()" class="flex-1 py-4 font-bold text-center ${state.adminTab === 'edit' ? 'bg-indigo-50 text-indigo-700 border-b-2 border-indigo-700' : 'text-gray-500 hover:bg-gray-50'}">
                Edit / Remove Product
              </button>
            </div>

            <div class="p-8">
              ${state.adminTab === 'add' ? `
                <form onsubmit="handleAddProduct(event)" class="space-y-4 max-w-lg mx-auto">
                  <h3 class="text-xl font-bold mb-4 text-gray-800">Add Product Details</h3>
                  <div>
                    <label class="block text-sm font-bold text-gray-700">Product Name</label>
                    <input type="text" name="name" required class="w-full border p-2 rounded">
                  </div>
                  <div>
                    <label class="block text-sm font-bold text-gray-700">Category</label>
                    <select name="category_id" required class="w-full border p-2 rounded">
                      ${state.categories.map(c => `<option value="${c.id}">${c.name}</option>`).join('')}
                    </select>
                  </div>
                  <div>
                    <label class="block text-sm font-bold text-gray-700">Price ($)</label>
                    <input type="number" step="0.01" name="price" required class="w-full border p-2 rounded">
                  </div>
                  <div>
                    <label class="block text-sm font-bold text-gray-700">Image URL</label>
                    <input type="url" name="image_url" placeholder="https://..." required class="w-full border p-2 rounded">
                  </div>
                  <div>
                    <label class="block text-sm font-bold text-gray-700">Description</label>
                    <textarea name="description" rows="3" required class="w-full border p-2 rounded"></textarea>
                  </div>
                  <button type="submit" class="w-full bg-green-600 text-white font-bold py-3 rounded hover:bg-green-700 shadow-lg">Create Product</button>
                </form>
              ` : `
                <div class="max-w-lg mx-auto space-y-6">
                  ${!state.adminSelectedProduct ? `
                    <div>
                      <label class="block text-sm font-bold text-gray-700 mb-2">1. Select Category</label>
                      <select onchange="state.adminSelectedCategory=this.value; render()" class="w-full border p-3 rounded bg-gray-50">
                        <option value="">-- Choose Category --</option>
                        ${state.categories.map(c => `<option value="${c.id}" ${state.adminSelectedCategory === c.id ? 'selected' : ''}>${c.name}</option>`).join('')}
                      </select>
                    </div>

                    ${state.adminSelectedCategory ? `
                      <div class="fade-in">
                        <label class="block text-sm font-bold text-gray-700 mb-2">2. Select Product to Edit</label>
                        <div class="border rounded max-h-60 overflow-y-auto">
                          ${filteredProducts.length === 0 ? '<div class="p-3 text-gray-500">No products found.</div>' : 
                            filteredProducts.map(p => `
                              <div onclick='state.adminSelectedProduct=${JSON.stringify(p)}; render()' class="p-3 border-b hover:bg-indigo-50 cursor-pointer flex justify-between items-center">
                                <span class="font-medium">${p.name}</span>
                                <span class="text-sm text-gray-500">$${p.price}</span>
                              </div>
                            `).join('')}
                        </div>
                      </div>
                    ` : ''}
                  ` : `
                    <div class="bg-gray-50 p-6 rounded-lg border relative fade-in">
                      <button onclick="state.adminSelectedProduct=null; render()" class="absolute top-2 right-2 text-gray-500 hover:text-gray-800">‚úï Cancel</button>
                      <h3 class="text-xl font-bold mb-4 text-gray-800">Editing: ${state.adminSelectedProduct.name}</h3>
                      
                      <form onsubmit="handleUpdateProduct(event)" class="space-y-4">
                        <div>
                          <label class="block text-sm font-bold text-gray-700">Name</label>
                          <input type="text" name="name" value="${state.adminSelectedProduct.name}" class="w-full border p-2 rounded">
                        </div>
                        <div>
                          <label class="block text-sm font-bold text-gray-700">Price</label>
                          <input type="number" step="0.01" name="price" value="${state.adminSelectedProduct.price}" class="w-full border p-2 rounded">
                        </div>
                        <div>
                          <label class="block text-sm font-bold text-gray-700">Image URL</label>
                          <input type="text" name="image_url" value="${state.adminSelectedProduct.image_url}" class="w-full border p-2 rounded">
                        </div>
                         <div>
                          <label class="block text-sm font-bold text-gray-700">Description</label>
                          <textarea name="description" rows="3" class="w-full border p-2 rounded">${state.adminSelectedProduct.description}</textarea>
                        </div>
                        <div>
                          <label class="block text-sm font-bold text-gray-700">Stock Status</label>
                          <select name="stock_status" class="w-full border p-2 rounded">
                            <option value="in_stock" ${state.adminSelectedProduct.stock_status === 'in_stock' ? 'selected' : ''}>In Stock</option>
                            <option value="out_of_stock" ${state.adminSelectedProduct.stock_status === 'out_of_stock' ? 'selected' : ''}>Out of Stock</option>
                          </select>
                        </div>
                        
                        <div class="flex gap-4 pt-4">
                          <button type="submit" class="flex-1 bg-blue-600 text-white font-bold py-2 rounded hover:bg-blue-700">Save Changes</button>
                          <button type="button" onclick="handleDeleteProduct()" class="flex-1 bg-red-100 text-red-700 font-bold py-2 rounded hover:bg-red-200">Delete Product</button>
                        </div>
                      </form>
                    </div>
                  `}
                </div>
              `}
            </div>
          </div>
        </div>
      `;
    }

    // --- Standard Components (Sidebar, Products, etc.) ---
    function Sidebar() {
      return `
          <div class="backdrop" onclick="toggleMenu()"></div> 
          <div class="sidebar-wrapper">
            <div class="p-4 border-b flex justify-between items-center bg-gray-50">
              <h2 class="text-xl font-extrabold text-gray-800">Menu</h2>
              <button onclick="toggleMenu()" class="p-2 hover:bg-gray-200 rounded-full text-gray-700">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
              </button>
            </div>
            <nav class="p-4 space-y-4 overflow-y-auto flex-grow bg-white">
              ${state.user ? `
                  <div style="background-color: #f0f4f8;" class="p-4 rounded-xl mb-4 border border-gray-200">
                    <p class="text-sm font-bold text-gray-800 truncate mb-1">Hi, ${state.user.email.split('@')[0]}</p>
                    <button onclick="handleLogout()" class="text-xs text-white bg-red-500 px-3 py-1 rounded hover:bg-red-600 w-full">Sign Out</button>
                  </div>
                ` : `<button onclick="navigate('auth')" class="w-full text-white py-3 rounded-xl font-bold mb-4 shadow-lg hover:shadow-xl" style="background-color: var(--color-primary);">Sign In</button>`}
              
              <div class="mb-4">
                <div class="font-extrabold text-xl mb-4 border-b pb-2 text-gray-900">Categories</div>
                <div class="space-y-1">
                  ${state.categories.map(cat => {
                    const theme = CATEGORY_THEMES[cat.slug] || CATEGORY_THEMES['default'];
                    return `<a href="#" onclick="navigate('category', '${cat.slug}'); return false;" class="flex items-center gap-4 py-3 px-3 hover:bg-gray-50 rounded-xl text-gray-700 transition-all group">
                      <span class="text-2xl w-8 text-center group-hover:scale-110 transition-transform">${theme.icon || '‚Ä¢'}</span>
                      <span class="font-bold text-base group-hover:text-indigo-600">${cat.name}</span>
                    </a>`
                  }).join('')}
                </div>
              </div>
              <a href="#" onclick="navigate('about'); return false;" class="block py-3 px-3 font-bold text-lg hover:text-indigo-600 rounded-xl hover:bg-gray-50" style="color: var(--color-primary);">About Us</a>
            </nav>
          </div>
      `;
    }

    function ProductCard(product) {
      return `
        <div class="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden transition-all duration-500 hover:shadow-2xl hover:scale-[1.02] flex flex-col h-full">
          <div class="relative group">
            <img src="${product.image_url}" alt="${product.name}" class="w-full h-64 object-cover">
            <div class="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center gap-3 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
              <button onclick="navigate('product', '${product.slug}'); return false;" class="bg-white text-gray-900 px-4 py-2 rounded-full font-bold text-sm shadow-md hover:bg-gray-100">View</button>
              <button onclick='window.addToCart(${JSON.stringify(product).replace(/'/g, "&#39;")})' class="text-white px-4 py-2 rounded-full font-bold text-sm shadow-md border-2 border-white" style="background-color: var(--color-accent); color: var(--color-primary);">+ Add</button>
            </div>
          </div>
          <div class="p-4 flex flex-col flex-grow">
            <h3 class="font-extrabold text-xl mb-1 truncate" style="color: var(--color-primary);">${product.name}</h3>
            <p class="text-gray-500 text-sm mb-3 line-clamp-2 h-10">${product.description}</p>
            <div class="mt-auto flex items-center justify-between">
              <span class="text-2xl font-extrabold" style="color: var(--color-secondary);">$${product.price}</span>
              <span class="px-3 py-1 bg-green-100 text-green-700 text-xs rounded-full font-bold">In Stock</span>
            </div>
          </div>
        </div>
      `;
    }

    // --- Pages (Home, Category, etc. - kept mostly same) ---
    function HomePage() {
      return `
        <div class="flex-1">
          <div class="py-20 text-white" style="background-image: linear-gradient(to right, var(--color-primary), var(--color-secondary));">
            <div class="max-w-7xl mx-auto px-4 text-center">
              <h1 class="text-5xl md:text-6xl font-extrabold mb-4">Experience Premium Shopping</h1>
              <p class="text-xl opacity-90 mb-8 font-light">Hand-picked collections, just for you.</p>
              <button onclick="window.scrollTo({top: 600, behavior: 'smooth'})" class="bg-white px-8 py-3 rounded-full font-bold hover:bg-gray-100 transition shadow-2xl" style="color: var(--color-primary);">Start Discovering</button>
            </div>
          </div>
          <div class="max-w-7xl mx-auto px-4 py-12">
            <h2 class="text-3xl font-extrabold mb-8 border-b pb-3" style="color: var(--color-primary);">Featured Collections</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
              ${state.products.map(p => ProductCard(p)).join('')}
            </div>
          </div>
        </div>
      `;
    }
    
    function CategoryPage() {
      const category = state.categories.find(c => c.slug === state.currentSlug);
      if (!category) return '<div class="p-10">Category not found</div>';
      const products = state.products.filter(p => p.category_id === category.id);
      return `
        <div class="flex-1 page-enter">
          <div class="text-white py-12" style="background-color: var(--color-secondary);">
            <div class="max-w-7xl mx-auto px-4">
              <h1 class="text-5xl font-extrabold flex items-center gap-4">${CATEGORY_THEMES[category.slug]?.icon || ''} ${category.name}</h1>
              <p class="mt-4 text-xl opacity-90">${category.description || ''}</p>
            </div>
          </div>
          <div class="max-w-7xl mx-auto px-4 py-12">
            ${products.length===0 ? '<p class="text-center py-10">No products found.</p>' : `<div class="grid grid-cols-1 md:grid-cols-3 gap-8">${products.map(p => ProductCard(p)).join('')}</div>`}
          </div>
        </div>`;
    }
    
    // ... [AuthPage, ProductPage, CartPage, AboutPage - same as previous, just ensure they are included in full file if copying locally] ...
    // For brevity in this response, I'm including the renders below.

    function AuthPage() { return `<div class="flex-1 flex justify-center items-center py-12 bg-gray-50"><div class="bg-white p-8 rounded-xl shadow-xl w-full max-w-md"><h2 class="text-3xl font-bold mb-6 text-center">${state.authMode==='signin'?'Sign In':'Register'}</h2><form onsubmit="handleAuth(event)" class="space-y-4"><input name="email" type="email" placeholder="Email" required class="w-full border p-3 rounded"><input name="password" type="password" placeholder="Password" required class="w-full border p-3 rounded"><button class="w-full bg-indigo-600 text-white py-3 rounded font-bold hover:bg-indigo-700">${state.loading?'...':state.authMode==='signin'?'Sign In':'Sign Up'}</button></form><div class="mt-4 text-center"><button onclick="setAuthMode('${state.authMode==='signin'?'signup':'signin'}')" class="text-indigo-600 font-bold underline">Switch to ${state.authMode==='signin'?'Sign Up':'Sign In'}</button></div></div></div>`; }
    
    function ProductPage() { 
      const p = state.products.find(x => x.slug === state.currentSlug);
      if(!p) return '<div>Not Found</div>';
      return `<div class="flex-1 max-w-7xl mx-auto px-4 py-12 page-enter"><button onclick="window.history.back()" class="mb-4">‚Üê Back</button><div class="grid md:grid-cols-2 gap-10"><img src="${p.image_url}" class="rounded-xl shadow-lg w-full max-h-[500px] object-contain bg-white"><div><h1 class="text-4xl font-extrabold mb-2">${p.name}</h1><p class="text-3xl font-bold mb-6" style="color:var(--color-primary)">$${p.price}</p><p class="text-gray-600 text-lg mb-6">${p.description}</p><button onclick='window.addToCart(${JSON.stringify(p).replace(/'/g, "&#39;")})' class="bg-indigo-600 text-white px-8 py-3 rounded-lg font-bold text-lg shadow-lg hover:bg-indigo-700">Add to Cart</button></div></div></div>`;
    }

    function CartPage() {
      const total = state.cart.reduce((a,b)=>a+(b.price*b.quantity),0);
      return `<div class="flex-1 max-w-4xl mx-auto px-4 py-12 page-enter"><h1 class="text-3xl font-bold mb-8">Shopping Cart</h1>${state.cart.length===0?'<p>Empty Cart</p>':`<div class="space-y-4">${state.cart.map(i=>`<div class="flex gap-4 items-center bg-white p-4 rounded shadow"><img src="${i.image_url}" class="w-20 h-20 object-cover rounded"><div class="flex-1"><h3 class="font-bold">${i.name}</h3><p>$${i.price}</p></div><div class="flex items-center gap-2"><button onclick="updateQuantity('${i.id}',${i.quantity-1})" class="px-2 bg-gray-200 rounded">-</button><span>${i.quantity}</span><button onclick="updateQuantity('${i.id}',${i.quantity+1})" class="px-2 bg-gray-200 rounded">+</button></div><button onclick="removeFromCart('${i.id}')" class="text-red-500">‚úï</button></div>`).join('')}</div><div class="mt-8 bg-white p-6 rounded shadow text-right"><p class="text-xl font-bold mb-4">Total: $${total.toFixed(2)}</p><button class="bg-green-600 text-white px-8 py-3 rounded font-bold">Checkout</button></div>`}</div>`;
    }
    
    function AboutPage() { return `<div class="flex-1 py-12 text-center"><h1 class="text-4xl font-bold mb-4">About Us</h1><p class="max-w-2xl mx-auto">We provide premium goods.</p></div>`; }

    // --- Render ---
    function render() {
      let content = '';
      if(state.currentPage==='home') content = HomePage();
      else if(state.currentPage==='category') content = CategoryPage();
      else if(state.currentPage==='product') content = ProductPage();
      else if(state.currentPage==='about') content = AboutPage();
      else if(state.currentPage==='cart') content = CartPage();
      else if(state.currentPage==='auth') content = AuthPage();
      else if(state.currentPage==='admin') content = AdminPage();

      const app = document.getElementById('app');
      app.className = state.menuOpen ? 'min-h-screen flex flex-col font-sans sidebar-open' : 'min-h-screen flex flex-col font-sans';
      app.innerHTML = `${Header()}${Sidebar()}<main class="flex-grow flex flex-col">${content}</main>${`
        <footer class="bg-gray-900 text-white py-8 text-center mt-auto"><p>¬© 2024 ShopHub</p></footer>
      `}`;
    }

    // --- Global Helpers ---
    window.toggleMenu = () => { state.menuOpen = !state.menuOpen; render(); };
    window.navigate = navigate;
    window.addToCart = async (p) => { 
      const existing = state.cart.find(i=>i.id===p.id);
      const qty = existing ? existing.quantity + 1 : 1;
      if(state.user) {
        await supabase.from('cart_items').upsert({ user_id: state.user.id, product_id: p.id, quantity: qty }, { onConflict: 'user_id, product_id' });
        const { data } = await supabase.from('cart_items').select(`*, products:product_id (*)`);
        state.cart = data.map(i => ({...i.products, id:i.product_id, quantity:i.quantity}));
      } else {
        if(existing) existing.quantity++; else state.cart.push({...p, quantity: 1});
      }
      render();
      const btn = document.getElementById('cart-icon-container');
      btn.classList.add('cart-pulse'); setTimeout(()=>btn.classList.remove('cart-pulse'),300);
    };
    window.removeFromCart = async (id) => {
       if(state.user) { await supabase.from('cart_items').delete().match({user_id:state.user.id, product_id:id}); window.location.reload(); } // simple reload for sync
       else { state.cart = state.cart.filter(i=>i.id!==id); render(); }
    };
    window.updateQuantity = async (id, q) => {
      if(q<1) return window.removeFromCart(id);
      if(state.user) { await supabase.from('cart_items').update({quantity:q}).match({user_id:state.user.id, product_id:id}); const {data}=await supabase.from('cart_items').select(`*, products:product_id (*)`); state.cart=data.map(i=>({...i.products, id:i.product_id, quantity:i.quantity})); render(); }
      else { state.cart.find(i=>i.id===id).quantity=q; render(); }
    };
    window.handleAuth = handleAuth;
    window.handleLogout = handleLogout;
    window.setAuthMode = (m) => { state.authMode=m; render(); };
    window.handleAddProduct = handleAddProduct;
    window.handleUpdateProduct = handleUpdateProduct;
    window.handleDeleteProduct = handleDeleteProduct;

    // --- Init ---
    async function init() {
      const [c, p] = await Promise.all([
        supabase.from('categories').select('*').order('display_order'),
        supabase.from('products').select('*')
      ]);
      state.categories = c.data || [];
      state.products = p.data || [];
      
      // Auth Listener
      supabase.auth.onAuthStateChange(async (evt, session) => {
        state.user = session?.user || null;
        state.isAdmin = state.user?.email === ADMIN_EMAIL;
        if(state.user) {
            const { data } = await supabase.from('cart_items').select(`*, products:product_id (*)`);
            if(data) state.cart = data.map(i => ({...i.products, id:i.product_id, quantity:i.quantity}));
        }
        render();
      });
      render();
    }
    init();
  </script>
</body>
</html>
