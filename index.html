<!DOCTYPE html>
<html lang="en">
<head>
Â  <meta charset="UTF-8">
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  <title>ShopHub - Your Online Store</title>
Â  <script src="https://cdn.tailwindcss.com"></script>
Â  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
Â  
Â  <style>
Â  Â  /* --- GLOBAL ANIMATIONS & CORE STYLES --- */
Â  Â  @keyframes fadeIn {
Â  Â  Â  from { opacity: 0; transform: translateY(10px); }
Â  Â  Â  to { opacity: 1; transform: translateY(0); }
Â  Â  }

Â  Â  /* Standard element fade-in for smooth loading */
Â  Â  .fade-in {
Â  Â  Â  animation: fadeIn 0.4s ease-out; /* Slower, smoother fade */
Â  Â  }

Â  Â  /* Animation for Cart item count update */
Â  Â  @keyframes cartPulse {
Â  Â  Â  0% { transform: scale(1); background-color: #f87171; } /* Red */
Â  Â  Â  50% { transform: scale(1.1); background-color: #ef4444; } /* Brighter Red */
Â  Â  Â  100% { transform: scale(1); background-color: #f87171; } /* Red */
Â  Â  }

Â  Â  /* Class to be toggled by JS when an item is added */
Â  Â  .cart-count-pulse {
Â  Â  Â  animation: cartPulse 0.3s ease-in-out;
Â  Â  }

Â  Â  /* New animation for button click feedback */
Â  Â  @keyframes buttonClick {
Â  Â  Â  0% { transform: scale(1); }
Â  Â  Â  50% { transform: scale(0.98); }
Â  Â  Â  100% { transform: scale(1); }
Â  Â  }

Â  Â  /* Apply click animation to all interactive buttons */
Â  Â  button:not(.loader-button), a.btn, a:not(.no-animation):hover, button:not(.no-animation):hover {
Â  Â  Â  transition: all 0.2s ease-in-out;
Â  Â  }
Â  Â  
Â  Â  button:active, a.btn:active {
Â  Â  Â  animation: buttonClick 0.1s ease-out;
Â  Â  }
Â  Â  
Â  Â  /* Spinner for loading states - Kept original styles for function */
Â  Â  .loader {
Â  Â  Â  border: 3px solid #f3f3f3;
Â  Â  Â  border-radius: 50%;
Â  Â  Â  border-top: 3px solid #4f46e5;
Â  Â  Â  width: 20px;
Â  Â  Â  height: 20px;
Â  Â  Â  -webkit-animation: spin 1s linear infinite;
Â  Â  Â  animation: spin 1s linear infinite;
Â  Â  }
Â  Â  @keyframes spin {
Â  Â  Â  0% { transform: rotate(0deg); }
Â  Â  Â  100% { transform: rotate(360deg); }
Â  Â  }
Â  </style>
</head>
<body class="bg-gray-50 text-gray-800">
Â  <div id="app"></div>

Â  <script type="module">
Â  Â  // --- Configuration (Update with your actual keys if they changed) ---
Â  Â  const SUPABASE_URL = 'https://thzmryhnyzhfewsyamjh.supabase.co';
Â  Â  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRoem1yeWhueXpoZmV3c3lhbWpoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ3NTgwMTAsImV4cCI6MjA4MDMzNDAxMH0.qvCid4pmsdcRogce4RZH5adl90Eq5d3ibwVoJI5qr-I';

Â  Â  // Initialize real Supabase Client
Â  Â  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

Â  Â  // --- Icons ---
Â  Â  const Icon = {
Â  Â  Â  Menu: () => '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>',
Â  Â  Â  X: () => '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>',
Â  Â  Â  Cart: () => '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>',
Â  Â  Â  ChevronDown: () => '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>',
Â  Â  Â  User: () => '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>',
Â  Â  Â  Google: () => '<svg class="w-5 h-5" viewBox="0 0 24 24"><path fill="currentColor" d="M21.35 11.1h-9.17v2.73h6.51c-.33 3.81-3.5 5.44-6.5 5.44C8.36 19.27 5 16.25 5 12c0-4.1 3.2-7.27 7.2-7.27 3.09 0 4.9 1.97 4.9 1.97L19 4.72S16.56 2 12.1 2C6.42 2 2.03 6.8 2.03 12c0 5.05 4.13 10 10.22 10 5.35 0 9.25-3.67 9.25-9.09 0-1.15-.15-1.81-.15-1.81z"/></svg>'
Â  Â  };

Â  Â  // --- State ---
Â  Â  let state = {
Â  Â  Â  user: null, // Logged in user
Â  Â  Â  currentPage: 'home',
Â  Â  Â  currentSlug: null,
Â  Â  Â  categories: [],
Â  Â  Â  products: [],
Â  Â  Â  cart: [], // Contains mixed local or DB items
Â  Â  Â  menuOpen: false,
Â  Â  Â  authMode: 'signin', // 'signin' or 'signup'
Â  Â  Â  loading: false
Â  Â  };

Â  Â  // --- Router ---
Â  Â  function navigate(page, slug = null) {
Â  Â  Â  state.currentPage = page;
Â  Â  Â  state.currentSlug = slug;
Â  Â  Â  state.menuOpen = false;
Â  Â  Â  window.scrollTo(0, 0);
Â  Â  Â  render();
Â  Â  }

Â  Â  // --- Auth Functions ---
Â  Â  async function handleAuth(e) {
Â  Â  Â  e.preventDefault();
Â  Â  Â  const email = e.target.email.value;
Â  Â  Â  const password = e.target.password.value;
Â  Â  Â  state.loading = true;
Â  Â  Â  render();

Â  Â  Â  let error = null;

Â  Â  Â  if (state.authMode === 'signup') {
Â  Â  Â  Â  const { data, error: suError } = await supabase.auth.signUp({
Â  Â  Â  Â  Â  email,
Â  Â  Â  Â  Â  password,
Â  Â  Â  Â  });
Â  Â  Â  Â  if (!suError) alert('Registration successful! Please sign in.');
Â  Â  Â  Â  error = suError;
Â  Â  Â  } else {
Â  Â  Â  Â  const { data, error: siError } = await supabase.auth.signInWithPassword({
Â  Â  Â  Â  Â  email,
Â  Â  Â  Â  Â  password,
Â  Â  Â  Â  });
Â  Â  Â  Â  error = siError;
Â  Â  Â  }

Â  Â  Â  state.loading = false;
Â  Â  Â  if (error) {
Â  Â  Â  Â  alert(error.message);
Â  Â  Â  Â  render();
Â  Â  Â  } else if (state.authMode === 'signin') {
Â  Â  Â  Â  navigate('home'); // Redirect after login
Â  Â  Â  }
Â  Â  }

Â  Â  async function handleGoogleLogin() {
Â  Â  Â  const { data, error } = await supabase.auth.signInWithOAuth({
Â  Â  Â  Â  provider: 'google',
Â  Â  Â  Â  options: {
Â  Â  Â  Â  Â  redirectTo: window.location.href // Redirect back to this page
Â  Â  Â  Â  }
Â  Â  Â  });
Â  Â  Â  if (error) alert(error.message);
Â  Â  }

Â  Â  async function handleLogout() {
Â  Â  Â  await supabase.auth.signOut();
Â  Â  Â  state.cart = []; // Clear DB cart from state
Â  Â  Â  navigate('home');
Â  Â  }

Â  Â  // --- Cart Functions (Hybrid: Local + DB) ---
Â  Â Â 
Â  Â  // Fetch cart from DB for logged in users
Â  Â  async function fetchCart() {
Â  Â  Â  if (!state.user) return;
Â  Â  Â  const { data, error } = await supabase
Â  Â  Â  Â  .from('cart_items')
Â  Â  Â  Â  .select(`
Â  Â  Â  Â  Â  *,
Â  Â  Â  Â  Â  products:product_id (*)
Â  Â  Â  Â  `);
Â  Â  Â Â 
Â  Â  Â  if (data) {
Â  Â  Â  Â  // Transform DB structure to UI structure
Â  Â  Â  Â  state.cart = data.map(item => ({
Â  Â  Â  Â  Â  ...item.products, // spread product details
Â  Â  Â  Â  Â  id: item.product_id, // ensure ID is product ID for consistency
Â  Â  Â  Â  Â  quantity: item.quantity
Â  Â  Â  Â  }));
Â  Â  Â  }
Â  Â  Â  render();
Â  Â  }

Â  Â  // Merge local guest cart into DB upon login
Â  Â  async function mergeCart() {
Â  Â  Â  const localCart = state.cart;
Â  Â  Â  if (localCart.length === 0) return;

Â  Â  Â  // Upsert each item
Â  Â  Â  for (const item of localCart) {
Â  Â  Â  Â  // This is a simplified merge: local cart quantity overrides or adds to DB cart.
Â  Â  Â  Â  // A more complex merge would sum quantities, but for simplicity, we use upsert.
Â  Â  Â  Â  await supabase.from('cart_items').upsert({
Â  Â  Â  Â  Â  user_id: state.user.id,
Â  Â  Â  Â  Â  product_id: item.id,
Â  Â  Â  Â  Â  quantity: item.quantity
Â  Â  Â  Â  }, { onConflict: 'user_id, product_id' });
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  // Clear local cart (which is now in the DB)
Â  Â  Â  state.cart = [];
Â  Â  Â Â 
Â  Â  Â  // Re-fetch final source of truth
Â  Â  Â  await fetchCart();
Â  Â  }

Â  Â  async function addToCart(product) {
Â  Â  Â  // 1. Check if item exists in UI state first for immediate feedback
Â  Â  Â  const existing = state.cart.find(item => item.id === product.id);
Â  Â  Â  let newQuantity = existing ? existing.quantity + 1 : 1;
      
      // --- VISUAL FIX: Apply pulse animation before update ---
      const cartCountSpan = document.getElementById('cart-count-badge');
      if (cartCountSpan) {
          cartCountSpan.classList.add('cart-count-pulse');
          setTimeout(() => {
              cartCountSpan.classList.remove('cart-count-pulse');
          }, 400); // Animation duration is 300ms, use 400ms for safety
      }
      // --- END VISUAL FIX ---

Â  Â  Â  if (state.user) {
Â  Â  Â  Â  // DB Operation
Â  Â  Â  Â  const { error } = await supabase
Â  Â  Â  Â  Â  .from('cart_items')
Â  Â  Â  Â  Â  .upsert({Â 
Â  Â  Â  Â  Â  Â  user_id: state.user.id,Â 
Â  Â  Â  Â  Â  Â  product_id: product.id,Â 
Â  Â  Â  Â  Â  Â  quantity: newQuantityÂ 
Â  Â  Â  Â  Â  }, { onConflict: 'user_id, product_id' });

Â  Â  Â  Â  if (error) {
Â  Â  Â  Â  Â  console.error("Cart error", error);
Â  Â  Â  Â  Â  alert("Failed to update cart");
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  await fetchCart(); // Sync
Â  Â  Â  } else {
Â  Â  Â  Â  // Local Operation
Â  Â  Â  Â  if (existing) {
Â  Â  Â  Â  Â  existing.quantity++;
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  state.cart.push({ ...product, quantity: 1 });
Â  Â  Â  Â  }
Â  Â  Â  Â  render();
Â  Â  Â  }
Â  Â  }

Â  Â  async function removeFromCart(id) {
Â  Â  Â  if (state.user) {
Â  Â  Â  Â  await supabase.from('cart_items').delete().match({ user_id: state.user.id, product_id: id });
Â  Â  Â  Â  await fetchCart();
Â  Â  Â  } else {
Â  Â  Â  Â  state.cart = state.cart.filter(item => item.id !== id);
Â  Â  Â  Â  render();
Â  Â  Â  }
Â  Â  }

Â  Â  async function updateQuantity(id, quantity) {
Â  Â  Â  if (quantity < 1) {
Â  Â  Â  Â  removeFromCart(id);
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  if (state.user) {
Â  Â  Â  Â  await supabase
Â  Â  Â  Â  Â  .from('cart_items')
Â  Â  Â  Â  Â  .update({ quantity })
Â  Â  Â  Â  Â  .match({ user_id: state.user.id, product_id: id });
Â  Â  Â  Â  await fetchCart();
Â  Â  Â  } else {
Â  Â  Â  Â  const item = state.cart.find(item => item.id === id);
Â  Â  Â  Â  if (item) item.quantity = quantity;
Â  Â  Â  Â  render();
Â  Â  Â  }
Â  Â  }

Â  Â  // --- Components ---

Â  Â  function Header() {
Â  Â  Â  return `
Â  Â  Â  Â  <header class="bg-white shadow-lg sticky top-0 z-40 border-b border-gray-100">
Â  Â  Â  Â  Â  <div class="max-w-7xl mx-auto px-6 py-3 flex items-center justify-between">
Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-4">
Â  Â  Â  Â  Â  Â  Â  <button onclick="toggleMenu()" class="p-2 hover:bg-gray-100 rounded-lg transition-colors">
Â  Â  Â  Â  Â  Â  Â  Â  ${Icon.Menu()}
Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  <a href="#" onclick="navigate('home'); return false;" class="text-3xl font-extrabold text-indigo-700 tracking-tight">ShopHub</a>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-2">
Â  Â  Â  Â  Â  Â  Â  ${state.user ? `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="hidden md:flex items-center gap-4 mr-4 bg-indigo-50 p-2 rounded-full px-4 border border-indigo-100">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-sm font-medium text-indigo-700 truncate">Hi, ${state.user.email.split('@')[0]}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="handleLogout()" class="text-sm font-medium text-red-600 hover:text-red-700 hover:underline">Logout</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  ` : `
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="navigate('auth'); return false;" class="flex items-center gap-2 p-2 hover:bg-indigo-50 text-indigo-600 rounded-lg mr-2 transition-colors">
Â  Â  Â  Â  Â  Â  Â  Â  Â  ${Icon.User()}
Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="hidden md:inline text-sm font-semibold">Sign In</span>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  `}

Â  Â  Â  Â  Â  Â  Â  <button onclick="navigate('cart'); return false;" class="relative p-2 hover:bg-gray-100 rounded-lg transition-colors">
Â  Â  Â  Â  Â  Â  Â  Â  ${Icon.Cart()}
Â  Â  Â  Â  Â  Â  Â  Â  ${state.cart.length > 0 ? `
Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="cart-count-badge" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center font-bold shadow-md fade-in">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${state.cart.reduce((acc, item) => acc + item.quantity, 0)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  Â  ` : ''}
Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </header>
Â  Â  Â  `;
Â  Â  }

Â  Â  function Sidebar() {
Â  Â  Â  if (!state.menuOpen) return '';
Â  Â  Â  return `
Â  Â  Â  Â  <div class="fixed inset-0 bg-black bg-opacity-40 z-40 lg:hidden" onclick="toggleMenu()"></div>
Â  Â  Â  Â  <div class="fixed left-0 top-0 h-full w-64 bg-white shadow-2xl z-50 transform transition-transform duration-300 ${state.menuOpen ? 'translate-x-0' : '-translate-x-full'}">
Â  Â  Â  Â  Â  <div class="p-4 border-b flex justify-between items-center">
Â  Â  Â  Â  Â  Â  <h2 class="text-xl font-extrabold text-indigo-700">ShopHub Menu</h2>
Â  Â  Â  Â  Â  Â  <button onclick="toggleMenu()" class="p-2 hover:bg-red-50 text-red-500 rounded-lg transition-colors">
Â  Â  Â  Â  Â  Â  Â  ${Icon.X()}
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <nav class="p-4 space-y-4">
Â  Â  Â  Â  Â  Â  ${state.user ? `
Â  Â  Â  Â  Â  Â  Â  <div class="bg-indigo-50 p-3 rounded-lg border border-indigo-100 mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm font-semibold text-indigo-900 truncate">${state.user.email}</p>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="handleLogout()" class="text-xs text-red-600 mt-1 hover:underline font-medium">Sign Out</button>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  ` : `
Â  Â  Â  Â  Â  Â  Â  <button onclick="navigate('auth')" class="w-full bg-indigo-600 text-white py-2 rounded-lg font-bold mb-4 hover:bg-indigo-700 transition-colors shadow-md">Sign In / Register</button>
Â  Â  Â  Â  Â  Â  `}
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div class="mb-4">
Â  Â  Â  Â  Â  Â  Â  <div class="font-semibold mb-2 flex items-center gap-2 text-indigo-500 uppercase text-xs tracking-wider border-b pb-2">
Â  Â  Â  Â  Â  Â  Â  Â  Categories
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <div class="space-y-1">
Â  Â  Â  Â  Â  Â  Â  Â  ${state.categories.map(cat => `
Â  Â  Â  Â  Â  Â  Â  Â  Â  <a href="#" onclick="navigate('category', '${cat.slug}'); return false;" class="block py-2 px-2 hover:bg-indigo-50 rounded text-gray-700 font-medium transition-colors">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${cat.name}
Â  Â  Â  Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â  Â  Â  Â  `).join('')}
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <a href="#" onclick="navigate('about'); return false;" class="block py-2 font-semibold hover:text-indigo-600 transition-colors">
Â  Â  Â  Â  Â  Â  Â  About Us
Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â  </nav>
Â  Â  Â  Â  </div>
Â  Â  Â  `;
Â  Â  }

Â  Â  function AuthPage() {
Â  Â  Â  const isSignIn = state.authMode === 'signin';
Â  Â  Â  return `
Â  Â  Â  Â  <div class="flex-1 flex items-center justify-center px-4 py-12 bg-gray-50">
Â  Â  Â  Â  Â  <div class="bg-white p-8 rounded-2xl shadow-2xl max-w-md w-full border border-gray-100 fade-in">
Â  Â  Â  Â  Â  Â  <h2 class="text-3xl font-extrabold text-center mb-2 text-gray-900">${isSignIn ? 'Welcome Back' : 'Create Account'}</h2>
Â  Â  Â  Â  Â  Â  <p class="text-center text-gray-500 mb-8">
Â  Â  Â  Â  Â  Â  Â  ${isSignIn ? 'Sign in to access your cart and orders' : 'Register to start shopping with us'}
Â  Â  Â  Â  Â  Â  </p>

Â  Â  Â  Â  Â  Â  <form onsubmit="handleAuth(event)" class="space-y-5">
Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="email" name="email" required class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-colors">
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="password" name="password" required minlength="6" class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-colors">
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  <button type="submit" class="w-full bg-indigo-600 text-white py-3 rounded-xl font-bold hover:bg-indigo-700 transition-colors flex justify-center items-center h-12 shadow-lg shadow-indigo-200">
Â  Â  Â  Â  Â  Â  Â  Â  ${state.loading ? '<div class="loader"></div>' : (isSignIn ? 'Sign In' : 'Sign Up')}
Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </form>

Â  Â  Â  Â  Â  Â  <div class="relative my-6">
Â  Â  Â  Â  Â  Â  Â  <div class="absolute inset-0 flex items-center"><div class="w-full border-t border-gray-200"></div></div>
Â  Â  Â  Â  Â  Â  Â  <div class="relative flex justify-center text-sm"><span class="px-3 bg-white text-gray-500 font-medium">OR</span></div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <button onclick="handleGoogleLogin()" class="w-full border border-gray-300 text-gray-700 py-3 rounded-xl font-medium hover:bg-gray-50 transition-colors flex items-center justify-center gap-2 shadow-sm">
Â  Â  Â  Â  Â  Â  Â  ${Icon.Google()}
Â  Â  Â  Â  Â  Â  Â  Continue with Google
Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  <div class="mt-6 text-center text-sm">
Â  Â  Â  Â  Â  Â  Â  ${isSignIn ? 'Don\'t have an account?' : 'Already have an account?'}
Â  Â  Â  Â  Â  Â  Â  <button onclick="setAuthMode('${isSignIn ? 'signup' : 'signin'}')" class="text-indigo-600 font-bold hover:text-indigo-800 hover:underline">
Â  Â  Â  Â  Â  Â  Â  Â  ${isSignIn ? 'Sign up' : 'Sign in'}
Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  `;
Â  Â  }

Â  Â  function ProductCard(product) {
Â  Â  Â  return `
Â  Â  Â  Â  <div class="bg-white rounded-xl shadow-xl border border-gray-100 overflow-hidden transition-all duration-300 hover:shadow-2xl group fade-in">
Â  Â  Â  Â  Â  <div class="relative">
Â  Â  Â  Â  Â  Â  <img src="${product.image_url}" alt="${product.name}" class="w-full h-64 object-cover group-hover:scale-[1.03] transition-transform duration-300">
Â  Â  Â  Â  Â  Â  <div class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center gap-3 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
Â  Â  Â  Â  Â  Â  Â  <button onclick="navigate('product', '${product.slug}'); return false;" class="bg-white text-gray-900 px-5 py-2 rounded-full font-semibold text-sm hover:bg-gray-200 transition-colors shadow-lg">
Â  Â  Â  Â  Â  Â  Â  Â  View Details
Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  <button onclick='addToCart(${JSON.stringify(product).replace(/'/g, "&#39;")})' class="bg-red-500 text-white px-5 py-2 rounded-full font-semibold text-sm hover:bg-red-600 transition-colors shadow-lg">
Â  Â  Â  Â  Â  Â  Â  Â  Add to Cart
Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="p-5">
Â  Â  Â  Â  Â  Â  <h3 class="font-extrabold text-xl mb-1 truncate text-gray-900">${product.name}</h3>
Â  Â  Â  Â  Â  Â  <p class="text-gray-500 text-sm mb-3 line-clamp-2 h-10">${product.description}</p>
Â  Â  Â  Â  Â  Â  <div class="flex items-center justify-between">
Â  Â  Â  Â  Â  Â  Â  <span class="text-2xl font-bold text-indigo-700">$${product.price}</span>
Â  Â  Â  Â  Â  Â  Â  ${product.stock_status === 'in_stock' ? '<span class="px-3 py-1 bg-green-100 text-green-700 text-xs font-semibold rounded-full border border-green-200">In Stock</span>' : ''}
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  `;
Â  Â  }

Â  Â  function Footer() {
Â  Â  Â  return `
Â  Â  Â  Â  <footer class="bg-gray-900 text-white mt-auto border-t border-indigo-700">
Â  Â  Â  Â  Â  <div class="max-w-7xl mx-auto px-6 py-10">
Â  Â  Â  Â  Â  Â  <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
Â  Â  Â  Â  Â  Â  Â  <div class="text-center md:text-left mb-6 md:mb-0">
Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-3xl font-extrabold text-indigo-400">ShopHub</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-gray-400 text-sm mt-2">Quality products, excellent service.</p>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <div class="space-y-2 md:space-y-0 md:space-x-8 flex flex-col md:flex-row text-center">
Â  Â  Â  Â  Â  Â  Â  Â  <a href="#" onclick="navigate('home'); return false;" class="text-gray-300 hover:text-indigo-400 transition-colors font-medium">Home</a>
Â  Â  Â  Â  Â  Â  Â  Â  <a href="#" onclick="navigate('about'); return false;" class="text-gray-300 hover:text-indigo-400 transition-colors font-medium">About</a>
Â  Â  Â  Â  Â  Â  Â  Â  <a href="#" onclick="navigate('cart'); return false;" class="text-gray-300 hover:text-indigo-400 transition-colors font-medium">Cart</a>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="text-center mt-8 pt-4 border-t border-gray-700">
Â  Â  Â  Â  Â  Â  Â  <p class="text-sm text-gray-500">Â© 2024 ShopHub. All rights reserved.</p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </footer>
Â  Â  Â  `;
Â  Â  }

Â  Â  function HomePage() {
Â  Â  Â  return `
Â  Â  Â  Â  <div class="flex-1">
Â  Â  Â  Â  Â  <div class="bg-gray-900 text-white py-24 shadow-inner fade-in" style="background-image: url('https://images.unsplash.com/photo-1555529693-18a00f2795a9?q=80&w=1770&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D'); background-size: cover; background-position: center; position: relative;">
Â  Â  Â  Â  Â  Â  <div class="absolute inset-0 bg-black opacity-60"></div>
Â  Â  Â  Â  Â  Â  <div class="relative max-w-7xl mx-auto px-6 text-center">
Â  Â  Â  Â  Â  Â  Â  <h1 class="text-5xl md:text-7xl font-extrabold mb-4 tracking-tighter drop-shadow-lg">Welcome to ShopHub</h1>
Â  Â  Â  Â  Â  Â  Â  <p class="text-xl md:text-2xl text-indigo-200 mb-10 drop-shadow">Discover amazing products at unbeatable prices</p>
Â  Â  Â  Â  Â  Â  Â  <button onclick="window.scrollTo({top: 800, behavior: 'smooth'})" class="bg-red-500 text-white px-10 py-4 rounded-full font-bold text-lg hover:bg-red-600 transition-colors shadow-xl shadow-red-300/50">Shop Now</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="max-w-7xl mx-auto px-6 py-16">
Â  Â  Â  Â  Â  Â  <h2 class="text-4xl font-bold mb-10 text-gray-900 border-b pb-3">ðŸ”¥ Featured Products</h2>
Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
Â  Â  Â  Â  Â  Â  Â  ${state.products.map(product => ProductCard(product)).join('')}
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  `;
Â  Â  }

Â  Â  function CategoryPage() {
Â  Â  Â  const category = state.categories.find(c => c.slug === state.currentSlug);
Â  Â  Â  if (!category) return '<div class="flex-1 flex items-center justify-center"><div class="text-xl">Category not found</div></div>';
Â  Â  Â Â 
Â  Â  Â  const products = state.products.filter(p => p.category_id === category.id);
Â  Â  Â Â 
Â  Â  Â  return `
Â  Â  Â  Â  <div class="flex-1 fade-in">
Â  Â  Â  Â  Â  <div class="bg-indigo-700 text-white py-16 shadow-lg">
Â  Â  Â  Â  Â  Â  <div class="max-w-7xl mx-auto px-6">
Â  Â  Â  Â  Â  Â  Â  <h1 class="text-4xl font-extrabold">${category.name}</h1>
Â  Â  Â  Â  Â  Â  Â  ${category.description ? `<p class="mt-3 text-lg text-indigo-200">${category.description}</p>` : ''}
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="max-w-7xl mx-auto px-6 py-16">
Â  Â  Â  Â  Â  Â  ${products.length === 0 ?Â 
Â  Â  Â  Â  Â  Â  Â  '<p class="text-center text-gray-600 py-12 text-xl font-medium">No products in this category yet. Check back soon!</p>' :
Â  Â  Â  Â  Â  Â  Â  `<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
Â  Â  Â  Â  Â  Â  Â  Â  ${products.map(product => ProductCard(product)).join('')}
Â  Â  Â  Â  Â  Â  Â  </div>`
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  `;
Â  Â  }

Â  Â  function ProductPage() {
Â  Â  Â  const product = state.products.find(p => p.slug === state.currentSlug);
Â  Â  Â  if (!product) return '<div class="flex-1 flex items-center justify-center"><div class="text-xl">Product not found</div></div>';
Â  Â  Â Â 
Â  Â  Â  return `
Â  Â  Â  Â  <div class="flex-1 max-w-7xl mx-auto px-6 py-16 fade-in">
Â  Â  Â  Â  Â  <div class="grid md:grid-cols-2 gap-12 bg-white p-8 rounded-2xl shadow-xl border border-gray-100">
Â  Â  Â  Â  Â  Â  <div class="p-4 bg-gray-50 rounded-xl shadow-inner flex items-center justify-center">
Â  Â  Â  Â  Â  Â  Â  <img src="${product.image_url}" alt="${product.name}" class="w-full rounded-lg object-contain h-96 transition-transform duration-300 hover:scale-[1.05]">
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="pt-4">
Â  Â  Â  Â  Â  Â  Â  <div class="mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-red-600 font-bold tracking-widest text-sm uppercase border-b-2 border-red-200 pb-1">Detailed View</span>
Â  Â  Â  Â  Â  Â  Â  Â  <h1 class="text-5xl font-extrabold text-gray-900 mt-2 leading-tight">${product.name}</h1>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <p class="text-4xl font-extrabold text-indigo-700 mb-8">$${product.price}</p>
Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  <div class="text-gray-600 space-y-4 mb-10 border-t border-b py-6">
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-lg font-medium leading-relaxed">${product.description}</p>
Â  Â  Â  Â  Â  Â  Â  Â  ${product.detailed_description ? `<p class="mt-4 text-sm">${product.detailed_description}</p>` : ''}
Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick='addToCart(${JSON.stringify(product).replace(/'/g, "&#39;")})' class="flex-1 bg-red-600 text-white px-8 py-4 rounded-xl font-bold hover:bg-red-700 transition-colors text-xl shadow-2xl shadow-red-300/60">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Add to Cart
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  `;
Â  Â  }

Â  Â  function AboutPage() {
Â  Â  Â  Â return `
Â  Â  Â  Â  <div class="flex-1 fade-in">
Â  Â  Â  Â  Â  <div class="bg-gray-100 py-16 shadow-inner">
Â  Â  Â  Â  Â  Â  <div class="max-w-7xl mx-auto px-6">
Â  Â  Â  Â  Â  Â  Â  <h1 class="text-4xl font-extrabold text-gray-900">Our Story</h1>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="max-w-4xl mx-auto px-6 py-16 space-y-10">
Â  Â  Â  Â  Â  Â  <section class="bg-white p-8 rounded-2xl shadow-xl border border-gray-100">
Â  Â  Â  Â  Â  Â  Â  <h2 class="text-3xl font-bold mb-4 text-indigo-700">Who We Are</h2>
Â  Â  Â  Â  Â  Â  Â  <p class="text-gray-700 leading-relaxed text-lg">
Â  Â  Â  Â  Â  Â  Â  Â  We are a passionate team dedicated to bringing you the best online shopping experience. Our mission is to connect you with quality products quickly and reliably.
Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  </section>
Â  Â  Â  Â  Â  Â  Â <section class="bg-indigo-50 p-8 rounded-2xl shadow-lg border border-indigo-100">
Â  Â  Â  Â  Â  Â  Â  <h2 class="text-3xl font-bold mb-4 text-indigo-800">Get in Touch</h2>
Â  Â  Â  Â  Â  Â  Â  <p class="text-indigo-700 font-medium">Email: <a href="mailto:support@shophub.com" class="hover:underline">support@shophub.com</a></p>
Â  Â  Â  Â  Â  Â  </section>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  `;
Â  Â  }

Â  Â  function CartPage() {
Â  Â  Â  const total = state.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
Â  Â  Â Â 
Â  Â  Â  return `
Â  Â  Â  Â  <div class="flex-1 max-w-4xl mx-auto px-6 py-16 fade-in">
Â  Â  Â  Â  Â  <h1 class="text-4xl font-extrabold mb-10 text-gray-900 border-b pb-3">ðŸ›’ Your Shopping Cart</h1>
Â  Â  Â  Â  Â  ${state.cart.length === 0 ? `
Â  Â  Â  Â  Â  Â  <div class="text-center py-20 bg-white rounded-2xl shadow-xl border border-dashed border-gray-200">
Â  Â  Â  Â  Â  Â  Â  <div class="text-indigo-400 mb-6 mx-auto w-12 h-12">${Icon.Cart()}</div>
Â  Â  Â  Â  Â  Â  Â  <p class="text-xl text-gray-700 mb-4 font-semibold">Your cart is empty!</p>
Â  Â  Â  Â  Â  Â  Â  <a href="#" onclick="navigate('home'); return false;" class="text-red-600 hover:text-red-800 font-bold underline transition-colors">Start Browsing Our Products</a>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  ` : `
Â  Â  Â  Â  Â  Â  <div class="space-y-6 mb-10">
Â  Â  Â  Â  Â  Â  Â  ${state.cart.map(item => `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col sm:flex-row gap-6 bg-white p-6 rounded-2xl shadow-lg border border-gray-100 items-center transition-shadow hover:shadow-xl">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${item.image_url}" alt="${item.name}" class="w-full sm:w-28 h-28 object-cover rounded-xl border border-gray-200">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-1 text-center sm:text-left">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="font-extrabold text-xl text-gray-900">${item.name}</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-indigo-700 font-bold text-lg mt-1">$${item.price.toFixed(2)}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="updateQuantity('${item.id}', ${item.quantity - 1})" class="w-9 h-9 flex items-center justify-center bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors text-lg font-bold">-</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="w-8 text-center font-bold text-xl">${item.quantity}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="updateQuantity('${item.id}', ${item.quantity + 1})" class="w-9 h-9 flex items-center justify-center bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors text-lg font-bold">+</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="removeFromCart('${item.id}')" class="text-red-500 hover:text-red-700 p-2 hover:bg-red-50 rounded-lg transition-colors">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${Icon.X()}
Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  `).join('')}
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="bg-white p-8 rounded-2xl shadow-2xl border border-gray-100 sticky top-20">
Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold mb-4 border-b pb-3 text-gray-900">Order Summary</h2>
Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between text-xl mb-6">
Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-gray-600 font-medium">Total</span>
Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-3xl font-extrabold text-red-600">$${total.toFixed(2)}</span>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  ${!state.user ? `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-yellow-100 border border-yellow-300 p-4 rounded-xl mb-4 text-sm text-yellow-800 font-medium">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-bold">Note:</span> Please <button onclick="navigate('auth')" class="underline font-extrabold text-yellow-900">sign in</button> to checkout and save your cart permanently.
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  ` : ''}
Â  Â  Â  Â  Â  Â  Â  <button class="w-full bg-red-600 text-white py-4 rounded-xl font-bold text-xl hover:bg-red-700 transition-colors shadow-2xl shadow-red-300/60">
Â  Â  Â  Â  Â  Â  Â  Â  Proceed to Checkout
Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  `}
Â  Â  Â  Â  </div>
Â  Â  Â  `;
Â  Â  }

Â  Â  // --- Render Loop ---
Â  Â  function render() {
Â  Â  Â  let content = '';
Â  Â  Â  switch(state.currentPage) {
Â  Â  Â  Â  case 'home': content = HomePage(); break;
Â  Â  Â  Â  case 'category': content = CategoryPage(); break;
Â  Â  Â  Â  case 'product': content = ProductPage(); break;
Â  Â  Â  Â  case 'about': content = AboutPage(); break;
Â  Â  Â  Â  case 'cart': content = CartPage(); break;
Â  Â  Â  Â  case 'auth': content = AuthPage(); break;
Â  Â  Â  }

Â  Â  Â  document.getElementById('app').innerHTML = `
Â  Â  Â  Â  <div class="min-h-screen flex flex-col font-sans">
Â  Â  Â  Â  Â  ${Header()}
Â  Â  Â  Â  Â  ${Sidebar()}
Â  Â  Â  Â  Â  ${content}
Â  Â  Â  Â  Â  ${Footer()}
Â  Â  Â  Â  </div>
Â  Â  Â  `;
Â  Â  }

Â  Â  // --- Global Helpers ---
Â  Â  window.toggleMenu = () => { state.menuOpen = !state.menuOpen; render(); };
Â  Â  window.navigate = navigate;
Â  Â  window.addToCart = addToCart;
Â  Â  window.removeFromCart = removeFromCart;
Â  Â  window.updateQuantity = updateQuantity;
Â  Â  window.handleAuth = handleAuth;
Â  Â  window.handleGoogleLogin = handleGoogleLogin;
Â  Â  window.handleLogout = handleLogout;
Â  Â  window.setAuthMode = (mode) => { state.authMode = mode; render(); };

Â  Â  // --- Initialization ---
Â  Â  async function init() {
Â  // Temporarily remove the Auth Listener for the test,Â 
Â  // as asynchronous functions can complicate debugging.
Â Â 
Â  try {
Â  Â  console.log("Starting data fetch...");
Â  Â Â 
Â  Â  const [categoriesRes, productsRes] = await Promise.all([
Â  Â  Â  supabase.from('categories').select('*').order('display_order'),
Â  Â  Â  supabase.from('products').select('*').eq('is_active', true)
Â  Â  ]);
Â  Â Â 
Â  Â  // Check for RLS/Network errors explicitly
Â  Â  if (categoriesRes.error) {
Â  Â  Â  console.error("Categories Fetch Error:", categoriesRes.error);
Â  Â  Â  alert("Error loading categories! Check RLS policy.");
Â  Â  Â  return; // Stop if there's an error
Â  Â  }
Â  Â  if (productsRes.error) {
Â  Â  Â  console.error("Products Fetch Error:", productsRes.error);
Â  Â  Â  alert("Error loading products! Check RLS policy.");
Â  Â  Â  return; // Stop if there's an error
Â  Â  }

Â  Â  state.categories = categoriesRes.data || [];
Â  Â  state.products = productsRes.data || [];
Â  Â Â 
Â  Â  console.log("Data loaded successfully. Categories found:", state.categories.length);

Â  } catch (e) {
Â  Â  // Catch any unexpected Promise.all execution errors
Â  Â  console.error("CRITICAL INIT ERROR:", e);
Â  Â  alert("Critical application error during initialization. Check console.");
Â  } finally {
Â  Â  // RENDER IS ALWAYS CALLED, even if data is empty!
Â  Â  // This ensures you see the basic site structure.
Â  Â  render();Â 
Â  }

Â  // Rerun the Auth Listener setup after initial render
Â  supabase.auth.onAuthStateChange(async (event, session) => {
Â  Â  const previousUser = state.user;
Â  Â  state.user = session?.user || null;
Â  Â Â 
Â  Â  if (!previousUser && state.user) {
Â  Â  Â  await mergeCart();
Â  Â  }
Â  Â Â 
Â  Â  if (state.user) {
Â  Â  Â  await fetchCart();
Â  Â  }
Â  Â Â 
Â  Â  render();
Â  });
}
Â  Â  init();
Â Â 
Â  </script>
</body>
</html>
